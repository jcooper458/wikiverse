/*! jquery.tube.js 0.2.0 | https://github.com/inukshuk/jquery.tube.js/blob/master/LICENSE */
(function(e,t,n,r,i){"use strict";String.prototype.supplant||(String.prototype.supplant=function(e){return this.replace(/\{([^{}]*)\}/g,function(t,n){var r=e[n];return typeof r=="string"||typeof r=="number"?r:t})}),Array.prototype.remove=function(e,t){var n=this.slice((t||e)+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,n)};var s=function(t){return t=t||{},this.on=function(n,r){return t[n]=t[n]||[],e.isFunction(r)&&t[n].push(r),this},this.once=function(e,t){var n=this;return this.on(e,function(){n.off(e,t),t.apply(n,arguments)})},this.off=function(e,n){if(t[e]){var r,i=t[e],s=[];if(n){for(r=0;r<i.length;++r)i[r]===n&&s.push(r);for(r=0;r<s;++r)i.remove(r)}else t[e]=[]}return this},this.notify=function(){var n=this,r=Array.prototype.slice.apply(arguments),i=arguments[0];return t[i]&&e.each(t[i],function(){e.isFunction(this)&&this.apply(n,r)}),this},this},o=function(t){this.statistics={},this.thumbnails=[],this.acl={},t&&e.extend(this,t)};o.constants={users:"//www.youtube.com/user/{name}"},o.templates={thumbnail:'<img src="{url}" title="{title}" />',title:"<h1>{title} ({duration})</h1>",author:'<a href="{author_url}">{author}</a>',description:"<p>{description}</p>",statistics:'<span class="statistics">{views} / {favorites} / {uploaded}</span>',video:'<a href="#{id}" rel="{index}">{title}{thumbnail}{description}<p>{author} – {statistics}</p></a>'},o.parameters={v:2,alt:"json-in-script",callback:"?"},o.defaults={truncate:!1,at:"\n",max:140,omission:"…",thumbnail:"mqdefault",index:0};var u=function(e,t){var n=e.length,r;return t.at&&(r=e.indexOf(t.at))>=0&&(n=Math.min(n,r)),t.max?t.omission&&n-t.omission.length>t.max?e.slice(0,t.max-t.omission.length)+t.omission:e.slice(0,Math.min(t.max,n)):e.slice(0,n)},a=function(e){return("0"+e).slice(-2)},f=function(e){return e===null?"":typeof e!="object"?e:[e.getDate(),e.getMonth(),e.getFullYear()].join(".")};o.prototype.parse=function(t){var n=this;try{t.author&&e.isArray(t.author)&&(this.author={name:t.author[0].name.$t,id:t.author[0].uri.$t.match(/\/([^\/]*)$/)[1]},this.author.url=o.constants.users.supplant(this.author)),t.yt$statistics&&(this.statistics.favorites=t.yt$statistics.favoriteCount,this.statistics.views=t.yt$statistics.viewCount),t.yt$accessControl&&t.yt$accessControl.length&&e.each(t.yt$accessControl,function(){n.acl[this.action]=this.permission}),t.title&&(this.title=t.title.$t);if(t.updated)try{this.updated=new Date(Date.parse(t.updated.$t)||Date.parse(t.updated.$t.replace(/-/g,"/").replace(/T.*/,"")))}catch(r){}if(t.media$group){var i=t.media$group;i.yt$videoid&&(this.id=i.yt$videoid.$t),i.media$description&&(this.description=i.media$description.$t),i.yt$duration&&(this.duration_in_seconds=parseInt(i.yt$duration.seconds,10));if(i.yt$uploaded)try{this.uploaded=new Date(Date.parse(i.yt$uploaded.$t)||Date.parse(i.yt$uploaded.$t.replace(/-/g,"/").replace(/T.*/,"")))}catch(r){}i.media$thumbnail&&e.isArray(i.media$thumbnail)&&(this.thumbnails=e.map(i.media$thumbnail,function(e){return{width:e.width,height:e.height,url:e.url.replace(/^https?:\/\//,"//"),name:e.yt$name}}))}}catch(r){console.log(r)}return this},o.prototype.load=function(t,n){var r=this;return r.id=t,e.getJSON(r.request(),function(t){try{t.entry&&r.parse(t.entry),n&&e.isFunction(n)&&n.apply(r,[1,t,r])}catch(i){n&&e.isFunction(n)&&n.apply(r,[0,i,r])}}),this},o.prototype.request=function(e){return e=e||o.parameters,[l.constants.api,"videos","/",this.id,"?",l.serialize(e)].join("")},o.prototype.seconds=function(){return(this.duration_in_seconds||0)%60},o.prototype.minutes=function(){return parseInt((this.duration_in_seconds||0)/60,10)%60},o.prototype.hours=function(){return parseInt((this.duration_in_seconds||0)/3600,10)},o.prototype.duration=function(){if(!this.duration_in_seconds)return"";var e=this.hours(),t=this.minutes(),n=this.seconds();return(e?[e,a(t),a(n)]:[t,a(n)]).join(":")},o.prototype.visibility=function(){return this.is_listed()?"listed":"unlisted"},o.prototype.is_listed=function(){return this.acl.list!=="denied"},o.prototype.properties=function(t){if(typeof t.thumbnail=="string"){var n=0;e.each(this.thumbnails,function(e){if(this.name===t.thumbnail)return n=e,!1}),t.thumbnail=n}return{id:this.id,index:t.index,title:this.title,duration:this.duration(),description:t.truncate?u(this.description,t):this.description,author:this.author.name,author_url:this.author.url,views:this.statistics.views,visibility:this.visibility(),favorites:this.statistics.favorites,uploaded:f(this.uploaded),updated:f(this.updated),url:this.thumbnails[t.thumbnail].url}},o.prototype.render=function(t,n){var r=this.properties(e.extend({},o.defaults,n));return t=e.extend({},o.templates,t),t.video.supplant({id:r.id,index:r.index,visibility:r.visibility,title:t.title.supplant(r),thumbnail:t.thumbnail.supplant(r),description:t.description.supplant(r),author:t.author.supplant(r),statistics:t.statistics.supplant(r)})};var l=function(t){var n=this;this.videos=[],this.options=e.extend({},l.defaults,t),this.current=0,this.player=c.create(this.player_options()),this.options.templates=e.extend(o.templates,this.options.templates||{}),s.apply(this),e.each(l.events,function(e,t){n.options.events[t]&&n.on(t,n.options.events[t])}),e.each(c.events,function(t,r){n.player.on(r,e.proxy(n.notify,n,r)),n.options.events[r]&&n.on(r,n.options.events[r])})};l.constants={api:"//gdata.youtube.com/feeds/api/"},l.defaults={player:"player",autoload:!1,autoplay:!1,start:0,order:"relevance",author:!1,hide:2,controls:1,version:2,format:5,limit:10,key:!1,render:!0,truncate:!1,at:"\n",max:140,omission:"…",events:[],load:!1,complete:!1,click:!1},l.parameters={q:"query","max-results":"limit",key:"key",format:"format",orderby:"order",author:"author",v:"version"},l.events=["load","ready","stop","error"],l.serialize=function(t){var n;switch(typeof t){case"string":n=encodeURI(t);break;case"object":t===null?n="":n=e.map(t,function(e,t){if(e)return[encodeURI(t),encodeURI(e)].join("=")}).join("&");break;default:n=""}return n},l.prototype.load=function(t){var n=this,r=0,i;return this.options.list&&this.options.list.length?(i=function(i,s){i===0&&(t&&e.isFunction(t)&&t.apply(n,[r,s]),n.notify("error")),++r>=n.options.list.length&&(n.notify("load"),t&&e.isFunction(t)&&t.apply(n,[r]),n.notify("ready"))},this.videos=e.map(this.options.list,function(e){return(new o).load(e,i)})):e.getJSON(this.request(),function(i){try{r=i.feed.entry.length,n.videos=e.map(i.feed.entry,function(e){return(new o).parse(e)}),r&&(n.options.autoload||n.options.start)&&(n.current=Math.min(n.videos.length-1,Math.max(0,n.options.start-1)),n.player.load(n.videos[n.current])),n.notify("load"),t&&e.isFunction(t)&&t.apply(n,[r]),n.notify("ready")}catch(s){t&&e.isFunction(t)&&t.apply(n,[0,s]),n.notify("error")}}),this},l.prototype.player_options=function(){return{id:this.options.player,playerVars:e.extend({autoplay:this.options.autoplay,autohide:this.options.hide,controls:this.options.controls},c.defaults)}},l.prototype.parameters=function(){var t=this,n={};return e.each(l.parameters,function(e,r){t.options[r]&&(n[e]=t.options[r])}),this.options.playlist?delete n.orderby:this.options.user&&(n.orderby="published"),n.alt="json-in-script",n.callback="?",n},l.prototype.request=function(t){var n=l.constants.api;return e.extend(this.options,t||{}),this.options.playlist?n+="playlists/"+this.options.playlist.replace(/^PL/,""):this.options.user?n+=["users",this.options.user,"uploads"].join("/"):n+="videos",[n,"?",l.serialize(this.parameters())].join("")},l.prototype.authenticate=function(){return this},l.prototype.play=function(t){if(e.isNumeric(t)){var n=t%this.videos.length;this.current=n<0?this.videos.length-n:n,this.player&&this.videos.length&&this.player.play(this.videos[this.current])}else this.player.resume();return this},l.prototype.pause=function(e){return this.player&&this.player.pause(),this},l.prototype.stop=function(e){return this.player&&(this.player.stop(),this.notify("stop")),this},l.prototype.next=function(){return this.advance(1).notify("next")},l.prototype.previous=function(){return this.advance(-1).notify("previous")},l.prototype.advance=function(e){return this.play(this.current+(e||1))},l.prototype.render_options=function(t){return e.extend({},o.defaults,this.options,t||{})},l.prototype.render=function(){var t=this.options.templates,n=this.render_options(),r=e.map(this.videos,function(e,r){return n.index=r,"<li>"+e.render(t,n)+"</li>"});return"<ol>"+r.join("")+"</ol>"};var c=function(t){var n=this;this.options=e.extend({},c.defaults,t),this.p=null,s.apply(this),this.on("state",function(t,n){var r=e.isNumeric(n)?n:n&&n.data;switch(r){case-1:this.notify("unstarted");break;case 0:this.notify("end");break;case 1:this.notify("play");break;case 2:this.notify("pause");break;case 3:this.notify("buffer");break;case 5:this.notify("cue");break;default:}}),e.each(c.events,function(e,t){n.options.events[t]&&n.on(t,n.options.events[t])})};c.create=function(t){var n,r;return t=e.extend({},c.defaults,t),t.id=h(t.id),n=e("#"+t.id),r=n.data("player"),r||(r=new c(t),n.data("player",r)),r},c.constants={swfobject:"//ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"},c.constants.events={onReady:"ready",onStateChange:"state",onPlaybackQualityChange:"quality",onError:"error"},c.defaults={id:"player",width:640,height:390,wmode:"opaque",events:{},playerVars:{autohide:2,autoplay:0,controls:1,enablejsapi:1,loop:0,modestbranding:1}},c.callbacks=[],c.semaphore=0,c.events=["unstarted","end","play","cue","buffer","pause","error"];var h=function(t){return/^#|\./.test(t)?e(t).attr("id")||t:t};c.prototype.play=function(e){return this.p?(e?(this.p.current_video=e,this.p.loadVideoById(e.id||e,0,this.options.quality)):this.p.playVideo(),this):this.load(e)},c.prototype.resume=function(){return this.p&&this.p.playVideo(),this},c.prototype.pause=function(){return this.p&&this.p.pauseVideo(),this},c.prototype.stop=function(){return this.p&&this.p.stopVideo(),this},c.prototype.seek=function(e,t){return this.p&&(i===t&&(t=!0),this.p.seekTo(e,t)),this},c.prototype.clear=function(){return this.p&&(this.p.stopVideo(),this.p.clearVideo()),this},c.prototype.current_video=function(n){var r=this.p&&this.p.current_video;return r&&!r.id?(this.video=(new o).load(r,n),this.video):(e.isFunction(n)&&t.setTimeout(function(){n.apply(r,[1,!1,r])},0),r)},e.isFunction(t.postMessage)&&!e.browser.msie?(c.api="iframe",c.constants.api="https://www.youtube.com/player_api",c.prototype.event_proxy_for=function(t){return e.proxy(this.notify,this,t)},c.load=function(t){if(typeof YT=="undefined"){var r=n.createElement("script");return e.isFunction(t)&&c.callbacks.push(t),c.semaphore===0&&(c.semaphore=1,r.src=c.constants.api,e("script:first").before(r)),!1}return e.isFunction(t)&&setTimeout(t,0),!0},c.prototype.load=function(t){var n=this,r=e.extend({},this.options,{videoId:t.id||t,events:{}}),i=e("#"+r.id);return c.load(function(){try{e.each(c.constants.events,function(e,t){r.events[e]=n.event_proxy_for(t)}),n.p=new YT.Player(r.id,r),t&&(n.p.current_video=t)}catch(s){i.append("Failed to load YouTube player: "+s.toString())}}),this},t.onYouTubePlayerAPIReady=function(){e.each(c.callbacks,function(){this.call()})}):(c.api="js",c.constants.api="//www.youtube.com/v/{video}?enablejsapi=1&playerapiid={id}&version=3",c.constants.swf_version="8",c.defaults.playerVars.autoplay=1,c.prototype.event_proxy_for=function(e){var n=this,r=this.options.id.replace(/[\s-]/g,"_"),i=["event_proxy_for_player",r,e].join("_");return t[i]=function(){var t=Array.prototype.slice.apply(arguments);t.unshift(e),n.notify.apply(n,t)},i},c.load=function(t){return typeof swfobject=="undefined"?(e.getScript(c.constants.swfobject,function(){e.isFunction(t)&&t.call()}),!1):(e.isFunction(t)&&setTimeout(t,0),!0)},c.prototype.load=function(t){var r=this,i=e.extend({},this.options,{videoId:t.id||t,events:{}}),s=e("#"+i.id);return c.load(function(){try{c.callbacks.push(function(i){r.p=n.getElementById(i),e.each(c.constants.events,function(e,t){r.p.addEventListener(e,r.event_proxy_for(t))}),t&&(r.p.current_video=t)}),swfobject.embedSWF(c.constants.api.supplant({video:i.videoId,id:i.id}),i.id,i.width,i.height,c.constants.swf_version,null,i.playerVars,{allowScriptAccess:"always",wmode:"opaque"},{id:i.id})}catch(s){console.log("Failed to load YouTube player: ",s)}}),this},t.onYouTubePlayerReady=function(){var n=arguments;e.each(c.callbacks,function(){this.apply(t,n)})}),e.fn.tube=function(t){var n,r;return this.length&&(typeof t=="string"?r={query:t}:r=t,n=this.first(),n.data("tube",(new l(r)).load(function(t){var r=this,i;t?(r.options.render&&(i=e(r.render()),e("a[rel]",i).click(function(t){e.isFunction(r.options.click)&&r.options.click.apply(r,["click",this,t]),r.play(e(this).attr("rel"))}),e.isFunction(r.options.load)&&r.options.load.apply(r,["load",i,n]),n.append(i)),e.isFunction(r.options.complete)&&r.options.complete.apply(r,["complete",i,n])):e.isFunction(r.options.complete)&&r.options.complete.apply(r,["error",i,n])}))),this},e.fn.player=function(t){var n,r,i;return this.length&&(typeof t=="string"?r=e.extend({},e.player.defaults,{video:t}):r=e.extend({},e.player.defaults,t),n=this.first(),n.data("player")?n.data("player").play(r.video):(r.id=n.attr("id"),r.id||(n.attr("id","jquery-tube-player-"+e.player.counter++),r.id=n.attr("id")),r.video&&c.create(r).load(r.video))),this},e.tube={},e.tube.load_video=function(e,t){return(new o).load(e,t)},e.tube.constants=l.constants,e.tube.defaults=l.defaults,e.player={},e.player.defaults=c.defaults,e.player.counter=0})(jQuery,window,window.document,"0.2.0");
